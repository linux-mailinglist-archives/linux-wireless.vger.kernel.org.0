Return-Path: <linux-wireless-owner@vger.kernel.org>
X-Original-To: lists+linux-wireless@lfdr.de
Delivered-To: lists+linux-wireless@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 63876340103
	for <lists+linux-wireless@lfdr.de>; Thu, 18 Mar 2021 09:28:10 +0100 (CET)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S229775AbhCRI1a (ORCPT <rfc822;lists+linux-wireless@lfdr.de>);
        Thu, 18 Mar 2021 04:27:30 -0400
Received: from mx2.suse.de ([195.135.220.15]:36512 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S229708AbhCRI1U (ORCPT <rfc822;linux-wireless@vger.kernel.org>);
        Thu, 18 Mar 2021 04:27:20 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
        by mx2.suse.de (Postfix) with ESMTP id F1938AC17;
        Thu, 18 Mar 2021 08:27:18 +0000 (UTC)
Date:   Thu, 18 Mar 2021 09:27:18 +0100
Message-ID: <s5ha6r0kgt5.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     Emmanuel Grumbach <emmanuel.grumbach@intel.com>
Cc:     linux-wireless@vger.kernel.org, linux-kernel@vger.kernel.org
Subject: systemd-rfkill regression on 5.11 and later kernels
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Precedence: bulk
List-ID: <linux-wireless.vger.kernel.org>
X-Mailing-List: linux-wireless@vger.kernel.org

Hi,

we've received a bug report about rfkill change that was introduced in
5.11.  While the systemd-rfkill expects the same size of both read and
write, the kernel rfkill write cuts off to the old 8 bytes while read
gives 9 bytes, hence it leads the error:
  https://github.com/systemd/systemd/issues/18677
  https://bugzilla.opensuse.org/show_bug.cgi?id=1183147

As far as I understand from the log in the commit 14486c82612a, this
sounds like the intended behavior.  But if this was implemented in
that way just for the compatibility reason, it actually is worse,
introducing a regression. 

Although this can be addressed easily in the systemd side, the current
kernel behavior needs reconsideration, IMO.


thanks,

Takashi
