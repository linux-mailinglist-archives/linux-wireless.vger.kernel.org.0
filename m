Return-Path: <linux-wireless-owner@vger.kernel.org>
X-Original-To: lists+linux-wireless@lfdr.de
Delivered-To: lists+linux-wireless@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id 408B6295660
	for <lists+linux-wireless@lfdr.de>; Thu, 22 Oct 2020 04:28:53 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S2895059AbgJVC2v (ORCPT <rfc822;lists+linux-wireless@lfdr.de>);
        Wed, 21 Oct 2020 22:28:51 -0400
Received: from mailgw02.mediatek.com ([210.61.82.184]:43007 "EHLO
        mailgw02.mediatek.com" rhost-flags-OK-FAIL-OK-FAIL) by vger.kernel.org
        with ESMTP id S2443052AbgJVC2t (ORCPT
        <rfc822;linux-wireless@vger.kernel.org>);
        Wed, 21 Oct 2020 22:28:49 -0400
X-UUID: 51ec72cbd3db47368d3d8dfa18ca1eab-20201022
DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/relaxed; d=mediatek.com; s=dk;
        h=Content-Transfer-Encoding:Content-Type:MIME-Version:References:In-Reply-To:Message-ID:Date:Subject:CC:To:From; bh=ubohY/g8g7z0KWnRlK8MD461CtBHRICaCK/003ikeWU=;
        b=WJl4jBdRPiLEMFiMyJm/5QsPW/TJIrNDypKlCNkKw7zUZDopxv00RtW1oGZQ2nLPIf6Adl94kVBhmcgqNYRoHeGwfcrhbxnePP8V05OjJ410maxX0rOaHMnacwRX0OAg57+2Q2rF61KdQrQQGA2naTLSQFIMkShK2f+Gr6/bCrY=;
X-UUID: 51ec72cbd3db47368d3d8dfa18ca1eab-20201022
Received: from mtkexhb01.mediatek.inc [(172.21.101.102)] by mailgw02.mediatek.com
        (envelope-from <shayne.chen@mediatek.com>)
        (Cellopoint E-mail Firewall v4.1.14 Build 0819 with TLSv1.2 ECDHE-RSA-AES256-SHA384 256/256)
        with ESMTP id 2094947617; Thu, 22 Oct 2020 10:28:43 +0800
Received: from mtkcas08.mediatek.inc (172.21.101.126) by
 mtkmbs06n2.mediatek.inc (172.21.101.130) with Microsoft SMTP Server (TLS) id
 15.0.1497.2; Thu, 22 Oct 2020 10:28:40 +0800
Received: from mtksdccf07.mediatek.inc (172.21.84.99) by mtkcas08.mediatek.inc
 (172.21.101.73) with Microsoft SMTP Server id 15.0.1497.2 via Frontend
 Transport; Thu, 22 Oct 2020 10:28:40 +0800
From:   Shayne Chen <shayne.chen@mediatek.com>
To:     Felix Fietkau <nbd@nbd.name>
CC:     linux-wireless <linux-wireless@vger.kernel.org>,
        Lorenzo Bianconi <lorenzo.bianconi@redhat.com>,
        Ryder Lee <ryder.lee@mediatek.com>,
        Evelyn Tsai <evelyn.tsai@mediatek.com>,
        linux-mediatek <linux-mediatek@lists.infradead.org>,
        Shayne Chen <shayne.chen@mediatek.com>
Subject: [PATCH v4 09/10] mt76: mt7915: add support to set txpower in testmode
Date:   Thu, 22 Oct 2020 10:28:19 +0800
Message-ID: <20201022022820.3077-9-shayne.chen@mediatek.com>
X-Mailer: git-send-email 2.18.0
In-Reply-To: <20201022022820.3077-1-shayne.chen@mediatek.com>
References: <20201022022820.3077-1-shayne.chen@mediatek.com>
MIME-Version: 1.0
Content-Type: text/plain
X-TM-SNTS-SMTP: 5D845305484DD9A37B32C0F4A5DE34B00AF662C04656B7EB7C84E42D6C7FB5842000:8
X-MTK:  N
Content-Transfer-Encoding: base64
Precedence: bulk
List-ID: <linux-wireless.vger.kernel.org>
X-Mailing-List: linux-wireless@vger.kernel.org

U3VwcG9ydCB0eF9wb3dlciBzZXR0aW5nIGluIHRlc3Rtb2RlLiBOb3RlIHRoYXQgdGhlIHR4IHBv
d2VyIHZhbHVlIG9mDQphbnRlbm5hIDEtMyBlcXVhbCB0byBhbnRlbm5hIDAuDQoNClJldmlld2Vk
LWJ5OiBSeWRlciBMZWUgPHJ5ZGVyLmxlZUBtZWRpYXRlay5jb20+DQpTaWduZWQtb2ZmLWJ5OiBT
aGF5bmUgQ2hlbiA8c2hheW5lLmNoZW5AbWVkaWF0ZWsuY29tPg0KLS0tDQogLi4uL3dpcmVsZXNz
L21lZGlhdGVrL210NzYvbXQ3OTE1L3Rlc3Rtb2RlLmMgIHwgMTAwICsrKysrKysrKysrKysrKysr
Kw0KIDEgZmlsZSBjaGFuZ2VkLCAxMDAgaW5zZXJ0aW9ucygrKQ0KDQpkaWZmIC0tZ2l0IGEvZHJp
dmVycy9uZXQvd2lyZWxlc3MvbWVkaWF0ZWsvbXQ3Ni9tdDc5MTUvdGVzdG1vZGUuYyBiL2RyaXZl
cnMvbmV0L3dpcmVsZXNzL21lZGlhdGVrL210NzYvbXQ3OTE1L3Rlc3Rtb2RlLmMNCmluZGV4IGMy
ZGQxOWQuLmIzNjQ5YmMgMTAwNjQ0DQotLS0gYS9kcml2ZXJzL25ldC93aXJlbGVzcy9tZWRpYXRl
ay9tdDc2L210NzkxNS90ZXN0bW9kZS5jDQorKysgYi9kcml2ZXJzL25ldC93aXJlbGVzcy9tZWRp
YXRlay9tdDc2L210NzkxNS90ZXN0bW9kZS5jDQpAQCAtNiw2ICs2LDE3IEBADQogI2luY2x1ZGUg
Im1jdS5oIg0KICNpbmNsdWRlICJ0ZXN0bW9kZS5oIg0KIA0KK2VudW0gew0KKwlUTV9DSEFOR0VE
X1RYUE9XRVIsDQorDQorCS8qIG11c3QgYmUgbGFzdCAqLw0KKwlOVU1fVE1fQ0hBTkdFRA0KK307
DQorDQorc3RhdGljIGNvbnN0IHU4IHRtX2NoYW5nZV9tYXBbXSA9IHsNCisJW1RNX0NIQU5HRURf
VFhQT1dFUl0gPSBNVDc2X1RNX0FUVFJfVFhfUE9XRVIsDQorfTsNCisNCiBzdHJ1Y3QgcmVnX2Jh
bmQgew0KIAl1MzIgYmFuZFsyXTsNCiB9Ow0KQEAgLTM1LDYgKzQ2LDQyIEBAIHN0YXRpYyBjb25z
dCBzdHJ1Y3QgcmVnX2JhbmQgcmVnX2JhY2t1cF9saXN0W10gPSB7DQogCVJFR19CQU5EKFdGX1JG
Q1IxKSwNCiB9Ow0KIA0KK3N0YXRpYyBpbnQNCittdDc5MTVfdG1fc2V0X3R4X3Bvd2VyKHN0cnVj
dCBtdDc5MTVfcGh5ICpwaHkpDQorew0KKwlzdHJ1Y3QgbXQ3OTE1X2RldiAqZGV2ID0gcGh5LT5k
ZXY7DQorCXN0cnVjdCBtdDc2X3BoeSAqbXBoeSA9IHBoeS0+bXQ3NjsNCisJc3RydWN0IGNmZzgw
MjExX2NoYW5fZGVmICpjaGFuZGVmID0gJm1waHktPmNoYW5kZWY7DQorCWludCBmcmVxID0gY2hh
bmRlZi0+Y2VudGVyX2ZyZXExOw0KKwlpbnQgcmV0Ow0KKwlzdHJ1Y3Qgew0KKwkJdTggZm9ybWF0
X2lkOw0KKwkJdTggZGJkY19pZHg7DQorCQlzOCB0eF9wb3dlcjsNCisJCXU4IGFudF9pZHg7CS8q
IE9ubHkgMCBpcyB2YWxpZCAqLw0KKwkJdTggY2VudGVyX2NoYW47DQorCQl1OCByc3ZbM107DQor
CX0gX19wYWNrZWQgcmVxID0gew0KKwkJLmZvcm1hdF9pZCA9IDB4ZiwNCisJCS5kYmRjX2lkeCA9
IHBoeSAhPSAmZGV2LT5waHksDQorCQkuY2VudGVyX2NoYW4gPSBpZWVlODAyMTFfZnJlcXVlbmN5
X3RvX2NoYW5uZWwoZnJlcSksDQorCX07DQorCXU4ICp0eF9wb3dlciA9IE5VTEw7DQorDQorCWlm
IChkZXYtPm10NzYudGVzdC5zdGF0ZSAhPSBNVDc2X1RNX1NUQVRFX09GRikNCisJCXR4X3Bvd2Vy
ID0gZGV2LT5tdDc2LnRlc3QudHhfcG93ZXI7DQorDQorCS8qIFR4IHBvd2VyIG9mIHRoZSBvdGhl
ciBhbnRlbm5hcyBhcmUgdGhlIHNhbWUgYXMgYW50ZW5uYSAwICovDQorCWlmICh0eF9wb3dlciAm
JiB0eF9wb3dlclswXSkNCisJCXJlcS50eF9wb3dlciA9IHR4X3Bvd2VyWzBdOw0KKw0KKwlyZXQg
PSBtdDc2X21jdV9zZW5kX21zZygmZGV2LT5tdDc2LA0KKwkJCQlNQ1VfRVhUX0NNRF9UWF9QT1dF
Ul9GRUFUVVJFX0NUUkwsDQorCQkJCSZyZXEsIHNpemVvZihyZXEpLCBmYWxzZSk7DQorDQorCXJl
dHVybiByZXQ7DQorfQ0KKw0KIHN0YXRpYyBpbnQNCiBtdDc5MTVfdG1fbW9kZV9jdHJsKHN0cnVj
dCBtdDc5MTVfZGV2ICpkZXYsIGJvb2wgZW5hYmxlKQ0KIHsNCkBAIC0xNzYsNiArMjIzLDEzIEBA
IG10NzkxNV90bV9zZXRfcnhfZnJhbWVzKHN0cnVjdCBtdDc5MTVfZGV2ICpkZXYsIGJvb2wgZW4p
DQogCW10NzkxNV90bV9zZXRfdHJ4KGRldiwgJmRldi0+cGh5LCBUTV9NQUNfUlhfUlhWLCBlbik7
DQogfQ0KIA0KK3N0YXRpYyB2b2lkDQorbXQ3OTE1X3RtX3VwZGF0ZV9wYXJhbXMoc3RydWN0IG10
NzkxNV9kZXYgKmRldiwgdTMyIGNoYW5nZWQpDQorew0KKwlpZiAoY2hhbmdlZCAmIEJJVChUTV9D
SEFOR0VEX1RYUE9XRVIpKQ0KKwkJbXQ3OTE1X3RtX3NldF90eF9wb3dlcigmZGV2LT5waHkpOw0K
K30NCisNCiBzdGF0aWMgaW50DQogbXQ3OTE1X3RtX3NldF9zdGF0ZShzdHJ1Y3QgbXQ3Nl9kZXYg
Km1kZXYsIGVudW0gbXQ3Nl90ZXN0bW9kZV9zdGF0ZSBzdGF0ZSkNCiB7DQpAQCAtMTk2LDYgKzI1
MCw1MSBAQCBtdDc5MTVfdG1fc2V0X3N0YXRlKHN0cnVjdCBtdDc2X2RldiAqbWRldiwgZW51bSBt
dDc2X3Rlc3Rtb2RlX3N0YXRlIHN0YXRlKQ0KIAllbHNlIGlmIChwcmV2X3N0YXRlID09IE1UNzZf
VE1fU1RBVEVfT0ZGIHx8IHN0YXRlID09IE1UNzZfVE1fU1RBVEVfT0ZGKQ0KIAkJbXQ3OTE1X3Rt
X2luaXQoZGV2KTsNCiANCisJaWYgKChzdGF0ZSA9PSBNVDc2X1RNX1NUQVRFX0lETEUgJiYNCisJ
ICAgICBwcmV2X3N0YXRlID09IE1UNzZfVE1fU1RBVEVfT0ZGKSB8fA0KKwkgICAgKHN0YXRlID09
IE1UNzZfVE1fU1RBVEVfT0ZGICYmDQorCSAgICAgcHJldl9zdGF0ZSA9PSBNVDc2X1RNX1NUQVRF
X0lETEUpKSB7DQorCQl1MzIgY2hhbmdlZCA9IDA7DQorCQlpbnQgaTsNCisNCisJCWZvciAoaSA9
IDA7IGkgPCBBUlJBWV9TSVpFKHRtX2NoYW5nZV9tYXApOyBpKyspIHsNCisJCQl1MTYgY3VyID0g
dG1fY2hhbmdlX21hcFtpXTsNCisNCisJCQlpZiAodGQtPnBhcmFtX3NldFtjdXIgLyAzMl0gJiBC
SVQoY3VyICUgMzIpKQ0KKwkJCQljaGFuZ2VkIHw9IEJJVChpKTsNCisJCX0NCisNCisJCW10Nzkx
NV90bV91cGRhdGVfcGFyYW1zKGRldiwgY2hhbmdlZCk7DQorCX0NCisNCisJcmV0dXJuIDA7DQor
fQ0KKw0KK3N0YXRpYyBpbnQNCittdDc5MTVfdG1fc2V0X3BhcmFtcyhzdHJ1Y3QgbXQ3Nl9kZXYg
Km1kZXYsIHN0cnVjdCBubGF0dHIgKip0YiwNCisJCSAgICAgZW51bSBtdDc2X3Rlc3Rtb2RlX3N0
YXRlIG5ld19zdGF0ZSkNCit7DQorCXN0cnVjdCBtdDc5MTVfZGV2ICpkZXYgPSBjb250YWluZXJf
b2YobWRldiwgc3RydWN0IG10NzkxNV9kZXYsIG10NzYpOw0KKwlzdHJ1Y3QgbXQ3Nl90ZXN0bW9k
ZV9kYXRhICp0ZCA9ICZkZXYtPm10NzYudGVzdDsNCisJdTMyIGNoYW5nZWQgPSAwOw0KKwlpbnQg
aTsNCisNCisJQlVJTERfQlVHX09OKE5VTV9UTV9DSEFOR0VEID49IDMyKTsNCisNCisJaWYgKG5l
d19zdGF0ZSA9PSBNVDc2X1RNX1NUQVRFX09GRiB8fA0KKwkgICAgdGQtPnN0YXRlID09IE1UNzZf
VE1fU1RBVEVfT0ZGKQ0KKwkJcmV0dXJuIDA7DQorDQorCWlmICh0ZC0+dHhfYW50ZW5uYV9tYXNr
ICYgfmRldi0+cGh5LmNoYWlubWFzaykNCisJCXJldHVybiAtRUlOVkFMOw0KKw0KKwlmb3IgKGkg
PSAwOyBpIDwgQVJSQVlfU0laRSh0bV9jaGFuZ2VfbWFwKTsgaSsrKSB7DQorCQlpZiAodGJbdG1f
Y2hhbmdlX21hcFtpXV0pDQorCQkJY2hhbmdlZCB8PSBCSVQoaSk7DQorCX0NCisNCisJbXQ3OTE1
X3RtX3VwZGF0ZV9wYXJhbXMoZGV2LCBjaGFuZ2VkKTsNCisNCiAJcmV0dXJuIDA7DQogfQ0KIA0K
QEAgLTI1Myw1ICszNTIsNiBAQCBtdDc5MTVfdG1fZHVtcF9zdGF0cyhzdHJ1Y3QgbXQ3Nl9kZXYg
Km1kZXYsIHN0cnVjdCBza19idWZmICptc2cpDQogDQogY29uc3Qgc3RydWN0IG10NzZfdGVzdG1v
ZGVfb3BzIG10NzkxNV90ZXN0bW9kZV9vcHMgPSB7DQogCS5zZXRfc3RhdGUgPSBtdDc5MTVfdG1f
c2V0X3N0YXRlLA0KKwkuc2V0X3BhcmFtcyA9IG10NzkxNV90bV9zZXRfcGFyYW1zLA0KIAkuZHVt
cF9zdGF0cyA9IG10NzkxNV90bV9kdW1wX3N0YXRzLA0KIH07DQotLSANCjIuMTcuMQ0K

