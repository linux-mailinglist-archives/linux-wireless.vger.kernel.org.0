Return-Path: <linux-wireless-owner@vger.kernel.org>
X-Original-To: lists+linux-wireless@lfdr.de
Delivered-To: lists+linux-wireless@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [23.128.96.18])
	by mail.lfdr.de (Postfix) with ESMTP id B6C1823BB45
	for <lists+linux-wireless@lfdr.de>; Tue,  4 Aug 2020 15:40:38 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1727064AbgHDNkg (ORCPT <rfc822;lists+linux-wireless@lfdr.de>);
        Tue, 4 Aug 2020 09:40:36 -0400
Received: from mx2.suse.de ([195.135.220.15]:52594 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1727982AbgHDNkf (ORCPT <rfc822;linux-wireless@vger.kernel.org>);
        Tue, 4 Aug 2020 09:40:35 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.221.27])
        by mx2.suse.de (Postfix) with ESMTP id D3D96ACF3;
        Tue,  4 Aug 2020 13:40:50 +0000 (UTC)
Date:   Tue, 04 Aug 2020 15:40:34 +0200
Message-ID: <s5hd046zfzh.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     linux-wireless@vger.kernel.org
Cc:     Holger Sickenberg <holgi@suse.com>
Subject: S3 resume failure regression with iwlwifi (6205) on recent kernels
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-wireless-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-wireless.vger.kernel.org>
X-Mailing-List: linux-wireless@vger.kernel.org

Hi,

we've got a but report about the Intel 6205 wireless on openSUSE Leap
15.2 regarding the suspend/resume.  The details are found in
  https://bugzilla.opensuse.org/show_bug.cgi?id=1174622

In short, WiFi device doesn't resume properly, showing errors like:

[ 1859.606056] iwlwifi 0000:03:00.0: Error sending REPLY_SCAN_ABORT_CMD: time out after 2000ms.
[ 1859.606058] iwlwifi 0000:03:00.0: Current CMD queue read_ptr 28 write_ptr 29
[ 1859.854420] iwlwifi 0000:03:00.0: Loaded firmware version: 18.168.6.1
[ 1859.854567] iwlwifi 0000:03:00.0: 0x00000000 | OK
[ 1859.854568] iwlwifi 0000:03:00.0: 0x00000000 | uPc
[ 1859.854569] iwlwifi 0000:03:00.0: 0x00000000 | branchlink1
.....

[ 1865.398517] iwlwifi 0000:00:1c.1: 00000200: 00000000 00000000 00000000
[ 1865.398520] iwlwifi 0000:03:00.0: Could not load the [0] uCode section
[ 1865.410833] iwlwifi 0000:03:00.0: Failed to run INIT ucode: -110
[ 1865.410868] iwlwifi 0000:03:00.0: Unable to initialize device.

And it triggers a few kernel WARNING:

[ 1865.410869] ------------[ cut here ]------------
[ 1865.410870] Hardware became unavailable during restart.
[ 1865.410917] WARNING: CPU: 2 PID: 5564 at ../net/mac80211/util.c:2193 ieee80211_reconfig+0x24c/0x1580 [mac80211]
.....


The kernel used above is based on 5.3.y, but the symptom was confirmed
to be reproduce with the recent kernel (5.7.9), too, so it seems still
persistent.

We tried different kernels to narrow down the regression range, and it
seems that the suspend/resume worked until 4.20.y, and the problem
started since 5.0.y kernel.

Let us know if any test fix or hint is available.


Thanks!

Takashi
