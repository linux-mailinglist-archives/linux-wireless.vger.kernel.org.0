Return-Path: <linux-wireless-owner@vger.kernel.org>
X-Original-To: lists+linux-wireless@lfdr.de
Delivered-To: lists+linux-wireless@lfdr.de
Received: from vger.kernel.org (vger.kernel.org [209.132.180.67])
	by mail.lfdr.de (Postfix) with ESMTP id C0741197477
	for <lists+linux-wireless@lfdr.de>; Mon, 30 Mar 2020 08:27:13 +0200 (CEST)
Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
        id S1728964AbgC3G1I (ORCPT <rfc822;lists+linux-wireless@lfdr.de>);
        Mon, 30 Mar 2020 02:27:08 -0400
Received: from mx2.suse.de ([195.135.220.15]:44476 "EHLO mx2.suse.de"
        rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
        id S1728489AbgC3G1I (ORCPT <rfc822;linux-wireless@vger.kernel.org>);
        Mon, 30 Mar 2020 02:27:08 -0400
X-Virus-Scanned: by amavisd-new at test-mx.suse.de
Received: from relay2.suse.de (unknown [195.135.220.254])
        by mx2.suse.de (Postfix) with ESMTP id C9E57AB8F;
        Mon, 30 Mar 2020 06:27:05 +0000 (UTC)
Date:   Mon, 30 Mar 2020 08:27:01 +0200
Message-ID: <s5hzhbybbnu.wl-tiwai@suse.de>
From:   Takashi Iwai <tiwai@suse.de>
To:     James Bottomley <James.Bottomley@HansenPartnership.com>
Cc:     George Spelvin <lkml@SDF.ORG>, linux-kernel@vger.kernel.org,
        Hannes Reinecke <hare@suse.de>, linux-scsi@vger.kernel.org,
        Marek Lindner <mareklindner@neomailbox.ch>,
        Simon Wunderlich <sw@simonwunderlich.de>,
        Antonio Quartulli <a@unstable.cc>,
        Sven Eckelmann <sven@narfation.org>,
        b.a.t.m.a.n@diktynna.open-mesh.org,
        Johannes Berg <johannes@sipsolutions.net>,
        linux-wireless@vger.kernel.org, Jaroslav Kysela <perex@perex.cz>,
        Takashi Iwai <tiwai@suse.com>, alsa-devel@alsa-project.org
Subject: Re: [RFC PATCH v1 13/50] Avoid some useless msecs/jiffies conversions
In-Reply-To: <1585505807.4510.1.camel@HansenPartnership.com>
References: <202003281643.02SGhBrh000992@sdf.org>
        <s5ho8sfd2dk.wl-tiwai@suse.de>
        <20200329121129.GC11951@SDF.ORG>
        <s5h7dz3ccea.wl-tiwai@suse.de>
        <20200329175032.GE4675@SDF.ORG>
        <1585505807.4510.1.camel@HansenPartnership.com>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/25.3
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
MIME-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
Sender: linux-wireless-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-wireless.vger.kernel.org>
X-Mailing-List: linux-wireless@vger.kernel.org

On Sun, 29 Mar 2020 20:16:47 +0200,
James Bottomley wrote:
> 
> On Sun, 2020-03-29 at 17:50 +0000, George Spelvin wrote:
> > On Sun, Mar 29, 2020 at 07:13:33PM +0200, Takashi Iwai wrote:
> > > On Sun, 29 Mar 2020 14:11:29 +0200, George Spelvin wrote:
> > > > On Sun, Mar 29, 2020 at 09:52:23AM +0200, Takashi Iwai wrote:
> > > > > I thought the compiler already optimizes to the constant
> > > > > calculation
> > > > > for the above case?
> > > > 
> > > > It optimizes that if the entire argument, including "seconds", is
> > > > a compile-time constant.
> > > > 
> > > > However, given "msecs_to_jiffies(hdev->rpa_timeout * 1000);",
> > > > the computatin is non-trivial.
> > > 
> > > Fair enough.  But it's still a question whether an open code X * HZ
> > > is
> > > good at all...
> > 
> > I'm sorry, I don't understand what you mean by "good at all" here.
> > The value computed is exactly the same.
> 
> I think he means what the compiler does with it.
> 
> We all assume that msecs_to_jiffies is properly optimized so there
> should be no need to open code it like you're proposing.

Yes, it'd be best if the compiler can handle it properly.

But also I meant to keep using the macro for consistency reason.
IIRC, we wanted to eliminate the explicit use of HZ in the past, and
it's how many lines have been converted with *_to_jiffies() calls.
I don't know whether the eliminate of HZ is still wished, but
reverting to the open code is a step backward for that.


thanks,

Takashi
